["Install and configure Vitest for unit tests\n- [ ] Install React Testing Library for component tests\n- [ ] Install Playwright for E2E tests\n- [ ] Configure test coverage reporting (c8/istanbul)\n- [ ] Set up test database (mock Supabase)\n\n**Implementation:**\n\n```bash\nnpm install -D vitest @vitest/ui @testing-library/react @testing-library/jest-dom @testing-library/user-event\nnpm install -D @playwright/test\nnpm install -D c8 @vitest/coverage-v8\n```\n\n**Test Structure:**\n```\ntests/\n\u251c\u2500\u2500 unit/\n\u2502   \u2514\u2500\u2500 lib/\n\u2502       \u251c\u2500\u2500 pdf-parser.test.ts\n\u2502       \u251c\u2500\u2500 claude-analyzer.test.ts\n\u2502       \u2514\u2500\u2500 section-normalizer.test.ts\n\u251c\u2500\u2500 integration/\n\u2502   \u2514\u2500\u2500 api/\n\u2502       \u2514\u2500\u2500 analyze.test.ts\n\u251c\u2500\u2500 e2e/\n\u2502   \u251c\u2500\u2500 upload.spec.ts\n\u2502   \u2514\u2500\u2500 report-view.spec.ts\n\u2514\u2500\u2500 __mocks__/\n    \u2514\u2500\u2500 supabase.ts\n```\n\n**Coverage Target:** 80% minimum, 90% for critical paths\n\n### 1.2 Developer Experience\n\n**Tasks:**\n- [ ] Configure ESLint with Next.js rules\n- [ ] Configure Prettier with consistent formatting\n- [ ] Install Husky for git hooks\n- [ ] Add lint-staged for pre-commit checks\n- [ ] Create Docker setup for local development\n\n**Implementation:**\n\n```bash\nnpm install -D eslint prettier eslint-config-prettier eslint-plugin-prettier\nnpm install -D husky lint-staged @commitlint/cli @commitlint/config-conventional\nnpx husky install\n```\n\n**Files to Create:**\n- `.eslintrc.json`\n- `.prettierrc`\n- `.prettierignore`\n- `.husky/pre-commit`\n- `.husky/commit-msg`\n- `Dockerfile`\n- `docker-compose.yml`\n\n### 1.3 Configuration Management\n\n**Tasks:**\n- [ ] Create centralized config file\n- [ ] Add environment variable validation with Zod\n- [ ] Document all configuration options\n\n**Implementation:**\n\n```typescript\n// lib/config.ts\nimport { z } from 'zod';\n\nconst envSchema = z.object({\n  VENICE_API_KEY: z.string().min(1),\n  DATABASE_URL: z.string().url(),\n  REDIS_URL: z.string().url().optional(),\n  SENTRY_DSN: z.string().url().optional(),\n  NODE_ENV: z.enum(['development', 'production', 'test']),\n  MAX_FILE_SIZE: z.coerce.number().default(75 * 1024 * 1024),\n  MAX_FILES: z.coerce.number().default(20),\n  RATE_LIMIT_MAX: z.coerce.number().default(5),\n  RATE_LIMIT_WINDOW_MS: z.coerce.number().default(60_000),\n});\n\nexport const env = envSchema.parse(process.env);\n```\n\n---\n\n## Phase 2: Database & Authentication (Weeks 3-4)\n\n### Goal: Add persistence and user management\n\n### 2.1 Database Layer (Supabase)\n\n**Tasks:**\n- [ ] Set up Supabase project\n- [ ] Create database schema\n- [ ] Configure Row Level Security (RLS)\n- [ ] Create database migrations\n- [ ] Set up connection pooling\n\n**Database Schema:**\n\n```sql\n-- Users\nCREATE TABLE users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  email TEXT UNIQUE NOT NULL,\n  full_name TEXT,\n  firm_name TEXT,\n  phone TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Properties\nCREATE TABLE properties (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n  address TEXT NOT NULL,\n  unit TEXT,\n  city TEXT,\n  province TEXT DEFAULT 'Ontario',\n  postal_code TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Reports\nCREATE TABLE reports (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n  property_id UUID REFERENCES properties(id) ON DELETE SET NULL,\n  corporation TEXT,\n  certificate_date DATE,\n  expiry_date DATE,\n  risk_rating TEXT CHECK (risk_rating IN ('GREEN', 'YELLOW', 'RED')),\n  status TEXT DEFAULT 'draft' CHECK (status IN ('draft', 'reviewed', 'sent')),\n  analysis JSONB NOT NULL,\n  documents_summary JSONB,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Documents\nCREATE TABLE documents (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  report_id UUID REFERENCES reports(id) ON DELETE CASCADE,\n  file_name TEXT NOT NULL,\n  file_type TEXT,\n  doc_type TEXT,\n  file_url TEXT NOT NULL,\n  file_size INTEGER,\n  page_count INTEGER,\n  page_offset INTEGER,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Subscriptions\nCREATE TABLE subscriptions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n  stripe_customer_id TEXT,\n  stripe_subscription_id TEXT,\n  plan TEXT CHECK (plan IN ('free', 'monthly', 'yearly')),\n  status TEXT,\n  certificates_used INTEGER DEFAULT 0,\n  certificates_limit INTEGER,\n  trial_ends_at TIMESTAMPTZ,\n  current_period_start TIMESTAMPTZ,\n  current_period_end TIMESTAMPTZ,\n  cancel_at_period_end BOOLEAN DEFAULT FALSE,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Audit Logs\nCREATE TABLE audit_logs (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n  report_id UUID REFERENCES reports(id) ON DELETE SET NULL,\n  action TEXT NOT NULL,\n  detail TEXT,\n  ip_address TEXT,\n  user_agent TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Indexes\nCREATE INDEX idx_reports_user_id ON reports(user_id);\nCREATE INDEX idx_reports_property_id ON reports(property_id);\nCREATE INDEX idx_reports_created_at ON reports(created_at DESC);\nCREATE INDEX idx_documents_report_id ON documents(report_id);\nCREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);\nCREATE INDEX idx_audit_logs_report_id ON audit_logs(report_id);\n```\n\n**Files to Create:**\n- `lib/supabase/client.ts` (browser client)\n- `lib/supabase/server.ts` (server client)\n- `lib/supabase/admin.ts` (admin client with service role)\n- `lib/db/queries.ts` (database queries)\n- `lib/db/migrations/` (SQL migrations)\n\n### 2.2 Authentication (NextAuth.js)\n\n**Tasks:**\n- [ ] Install NextAuth.js v5\n- [ ] Configure OAuth providers (Google, Microsoft)\n- [ ] Set up email/password authentication\n- [ ] Configure session management\n- [ ] Add protected route middleware\n\n**Implementation:**\n\n```bash\nnpm install next-auth@beta @auth/core\n```\n\n**Files to Create:**\n- `lib/auth/config.ts`\n- `lib/auth/providers.ts`\n- `app/api/auth/[...nextauth]/route.ts`\n- `middleware.ts`\n\n### 2.3 Report Persistence\n\n**Tasks:**\n- [ ] Update API to save reports to database\n- [ ] Implement report retrieval by ID\n- [ ] Add report listing endpoint\n- [ ] Implement report deletion\n- [ ] Add report history view\n\n**API Endpoints:**\n- `POST /api/reports` - Create report\n- `GET /api/reports` - List user's reports\n- `GET /api/reports/[id]` - Get specific report\n- `DELETE /api/reports/[id]` - Delete report\n- `GET /api/reports/[id]/compare` - Compare with another report\n\n---\n\n## Phase 3: Error Monitoring & Validation (Weeks 5-6)\n\n### Goal: Improve reliability and data integrity\n\n### 3.1 Sentry Configuration\n\n**Tasks:**\n- [ ] Configure Sentry for Next.js\n- [ ] Set up performance monitoring\n- [ ] Add error boundaries\n- [ ] Configure release tracking\n- [ ] Set up alerting rules\n\n**Implementation:**\n\n```typescript\n// lib/sentry.ts\nimport * as Sentry from '@sentry/nextjs';\n\nSentry.init({\n  dsn: process.env.SENTRY_DSN,\n  environment: process.env.NODE_ENV,\n  tracesSampleRate: 0.1,\n  beforeSend(event) {\n    // Filter out sensitive data\n    if (event.request) {\n      delete event.request.cookies;\n    }\n    return event;\n  },\n});\n```\n\n### 3.2 Input Validation (Zod)\n\n**Tasks:**\n- [ ] Create validation schemas for all API endpoints\n- [ ] Add validation middleware\n- [ ] Sanitize file uploads\n- [ ] Validate AI response structure\n\n**Validation Schemas:**\n\n```typescript\n// lib/validations/analyze.ts\nimport { z } from 'zod';\n\nexport const FileInputSchema = z.object({\n  fileName: z.string().min(1).max(255),\n  fileType: z.literal('application/pdf'),\n  docType: z.enum([\n    'status_certificate',\n    'budget',\n    'financial_statements',\n    'reserve_fund_study',\n    'insurance_certificate',\n    'declaration_bylaws',\n    'other',\n  ]),\n  file: z.string().min(1), // base64\n});\n\nexport const AnalyzeRequestSchema = z.object({\n  propertyId: z.string().uuid().optional(),\n  propertyAddress: z.string().min(1).max(500),\n  propertyUnit: z.string().max(50).optional(),\n  propertyCity: z.string().max(100).optional(),\n  files: z.array(FileInputSchema).min(1).max(20),\n});\n\nexport const AnalysisResponseSchema = z.object({\n  success: z.boolean(),\n  reportId: z.string().uuid(),\n  propertyId: z.string().uuid(),\n  property: z.object({\n    address: z.string(),\n    unit: z.string().optional(),\n    city: z.string().optional(),\n  }),\n  analysis: z.object({\n    corporation: z.string(),\n    address: z.string(),\n    certificate_date: z.string(),\n    expiry_date: z.string(),\n    sections: z.record(z.any()),\n    issues: z.array(z.any()),\n    risk_rating: z.enum(['GREEN', 'YELLOW', 'RED']),\n    summary: z.object({\n      total_items: z.number(),\n      verified: z.number(),\n      warnings: z.number(),\n      missing: z.number(),\n    }),\n  }),\n  documentsSummary: z.object({\n    count: z.number(),\n    successfulCount: z.number(),\n    failedCount: z.number(),\n    totalPages: z.number(),\n    totalSize: z.number(),\n  }),\n});\n```\n\n### 3.3 Logging Infrastructure\n\n**Tasks:**\n- [ ] Implement structured logging (pino)\n- [ ] Add request ID tracking\n- [ ] Configure log levels\n- [ ] Set up log aggregation\n\n**Implementation:**\n\n```bash\nnpm install pino pino-pretty\n```\n\n```typescript\n// lib/logger.ts\nimport pino from 'pino';\n\nexport const logger = pino({\n  level: process.env.LOG_LEVEL || 'info',\n  formatters: {\n    level: (label) => ({ level: label }),\n  },\n  timestamp: pino.stdTimeFunctions.isoTime,\n  base: {\n    env: process.env.NODE_ENV,\n  },\n});\n```\n\n---\n\n## Phase 4: Security Hardening (Weeks 7-8)\n\n### Goal: Implement production-grade security\n\n### 4.1 Rate Limiting (Redis)\n\n**Tasks:**\n- [ ] Install Redis client\n- [ ] Implement distributed rate limiting\n- [ ] Add API key-based rate limits\n- [ ] Configure user-specific quotas\n\n**Implementation:**\n\n```bash\nnpm install ioredis @upstash/redis\n```\n\n```typescript\n// lib/rate-limit.ts\nimport Redis from 'ioredis';\n\nconst redis = new Redis(process.env.REDIS_URL);\n\nexport async function checkRateLimit(\n  identifier: string,\n  limit: number,\n  window: number\n): Promise<{ allowed: boolean; remaining: number; resetAt: number }> {\n  const key = `ratelimit:${identifier}`;\n  const now = Date.now();\n  const windowStart = now - window;\n\n  const pipeline = redis.pipeline();\n  pipeline.zremrangebyscore(key, 0, windowStart);\n  pipeline.zcard(key);\n  pipeline.zadd(key, now, `${now}-${Math.random()}`);\n  pipeline.pexpire(key, window);\n\n  const results = await pipeline.exec();\n  const count = results?.[1]?.[1] as number || 0;\n\n  return {\n    allowed: count < limit,\n    remaining: Math.max(0, limit - count - 1),\n    resetAt: now + window,\n  };\n}\n```\n\n### 4.2 Security Headers\n\n**Tasks:**\n- [ ] Configure Content Security Policy\n- [ ] Add CSRF protection\n- [ ] Implement request signing\n- [ ] Add security-related headers\n\n**Implementation:**\n\n```typescript\n// middleware.ts\nimport { createMiddlewareClient } from '@supabase/auth-helpers-nextjs';\nimport { NextResponse } from 'next/server';\n\nexport async function middleware(req: NextRequest) {\n  const res = NextResponse.next();\n\n  // Security headers\n  res.headers.set('X-Content-Type-Options', 'nosniff');\n  res.headers.set('X-Frame-Options', 'DENY');\n  res.headers.set('X-XSS-Protection', '1; mode=block');\n  res.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n\n  // CSP\n  res.headers.set(\n    'Content-Security-Policy',\n    \"default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; font-src 'self' data:; connect-src 'self' https://api.venice.ai https://*.supabase.co;", "return res;\n}\n```\n\n### 4.3 File Security\n\n**Tasks:**\n- [ ] Implement PDF virus scanning (ClamAV)\n- [ ] Add file type validation\n- [ ] Implement file size limits\n- [ ] Add file content sanitization\n\n**Implementation:**\n\n```bash\nnpm install clamd\n```\n\n```typescript\n// lib/virus-scan.ts\nimport { createScanner } from 'clamd';\n\nexport async function scanFile(buffer: Buffer): Promise<{ clean: boolean; threat?: string }> {\n  const scanner = createScanner();\n  const result = await scanner.scanBuffer(buffer);\n\n  if (result.isInfected) {\n    return { clean: false, threat: result.threats.join(', ') };\n  }\n\n  return { clean: true };\n}\n```\n\n---\n\n## Phase 5: API Documentation & Monitoring (Weeks 9-10)\n\n### Goal: Improve developer experience and observability\n\n### 5.1 OpenAPI Documentation\n\n**Tasks:**\n- [ ] Install Swagger/OpenAPI tools\n- [ ] Create OpenAPI specification\n- [ ] Set up Swagger UI\n- [ ] Add API versioning\n\n**Implementation:**\n\n```bash\nnpm install swagger-ui-react @swagger-api/apidom\n```\n\n**Files to Create:**\n- `docs/openapi.yaml`\n- `app/api/docs/route.ts`\n\n### 5.2 Performance Monitoring\n\n**Tasks:**\n- [ ] Set up APM (Application Performance Monitoring)\n- [ ] Add custom metrics\n- [ ] Implement request tracing\n- [ ] Configure alerting\n\n### 5.3 Health Checks\n\n**Tasks:**\n- [ ] Enhance health check endpoint\n- [ ] Add database connectivity check\n- [ ] Add Redis connectivity check\n- [ ] Add external API check\n\n**Implementation:**\n\n```typescript\n// app/api/health/route.ts\nexport async function GET() {\n  const checks = {\n    status: 'ok',\n    timestamp: new Date().toISOString(),\n    checks: {\n      database: await checkDatabase(),\n      redis: await checkRedis(),\n      venice_api: await checkVeniceAPI(),\n    },\n  };\n\n  const allHealthy = Object.values(checks.checks).every(c => c.status === 'ok');\n\n  return NextResponse.json(checks, {\n    status: allHealthy ? 200 : 503,\n  });\n}\n```\n\n---\n\n## Phase 6: Feature Enhancements (Weeks 11-12)\n\n### Goal: Add value-added features\n\n### 6.1 Report Comparison\n\n**Tasks:**\n- [ ] Implement diff algorithm\n- [ ] Create comparison UI\n- [ ] Add export comparison feature\n- [ ] Implement change tracking\n\n### 6.2 Batch Analysis\n\n**Tasks:**\n- [ ] Add multi-property upload\n- [ ] Implement queue system\n- [ ] Add progress tracking\n- [ ] Create batch report view\n\n### 6.3 Custom Templates\n\n**Tasks:**\n- [ ] Create template editor\n- [ ] Implement template saving\n- [ ] Add template sharing\n- [ ] Create template library\n\n### 6.4 Notifications\n\n**Tasks:**\n- [ ] Implement email notifications\n- [ ] Add in-app notifications\n- [ ] Configure webhook integrations\n- [ ] Add notification preferences\n\n---\n\n## Phase 7: Accessibility & Performance (Weeks 13-14)\n\n### Goal: Improve UX and optimize performance\n\n### 7.1 Accessibility\n\n**Tasks:**\n- [ ] Run axe-core audit\n- [ ] Fix ARIA label issues\n- [ ] Improve keyboard navigation\n- [ ] Add screen reader optimization\n- [ ] Achieve WCAG 2.1 AA compliance\n\n**Implementation:**\n\n```bash\nnpm install -D @axe-core/react\n```\n\n### 7.2 Performance Optimization\n\n**Tasks:**\n- [ ] Implement request caching\n- [ ] Add CDN for static assets\n- [ ] Optimize bundle size\n- [ ] Add service worker\n- [ ] Implement lazy loading\n\n**Implementation:**\n\n```bash\nnpm install swr @tanstack/react-query\n```\n\n### 7.3 SEO Optimization\n\n**Tasks:**\n- [ ] Add meta tags\n- [ ] Implement structured data\n- [ ] Optimize images\n- [ ] Add sitemap\n- [ ] Configure robots.txt\n\n---\n\n## Phase 8: CI/CD & Deployment (Weeks 15-16)\n\n### Goal: Automate deployment pipeline\n\n### 8.1 CI/CD Pipeline\n\n**Tasks:**\n- [ ] Set up GitHub Actions\n- [ ] Configure automated testing\n- [ ] Implement automated deployments\n- [ ] Add staging environment\n- [ ] Configure rollback procedures\n\n**GitHub Actions Workflow:**\n\n```yaml\n# .github/workflows/ci.yml\nname: CI\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npm run lint\n      - run: npm run test\n      - run: npm run test:e2e\n\n  build:\n    runs-on: ubuntu-latest\n    needs: test\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: '20'\n          cache: 'npm'\n      - run: npm ci\n      - run: npm run build\n```\n\n### 8.2 Deployment Configuration\n\n**Tasks:**\n- [ ] Configure Vercel deployment\n- [ ] Set up environment variables\n- [ ] Configure custom domains\n- [ ] Set up SSL certificates\n- [ ] Configure CDN\n\n### 8.3 Monitoring & Alerting\n\n**Tasks:**\n- [ ] Set up uptime monitoring\n- [ ] Configure error alerts\n- [ ] Set up performance alerts\n- [ ] Create runbooks\n- [ ] Configure on-call rotation\n\n---\n\n## Success Metrics\n\n### Quality Metrics\n- Test Coverage: 80%+\n- Lighthouse Score: 90+\n- Accessibility Score: 95+\n- Bundle Size: <500KB\n\n### Performance Metrics\n- API Response Time: <2s (p95)\n- Page Load Time: <3s\n- Uptime: 99.9%\n- Error Rate: <0.1%\n\n### Business Metrics\n- User Conversion: 5%+\n- Report Completion: 90%+\n- User Retention: 60%+\n- NPS Score: 50+\n\n---\n\n## Risk Mitigation\n\n| Risk | Mitigation |\n|------|------------|\n| Database migration failure | Test migrations in staging, backup before deploy |\n| API rate limit exceeded | Implement exponential backoff, queue system |\n| AI service downtime | Fallback to cached results, clear error messages |\n| Security vulnerabilities | Regular security audits, dependency updates |\n| Performance degradation | Load testing, monitoring, auto-scaling |\n\n---\n\n## Timeline Summary\n\n| Phase | Duration | Key Deliverables |\n|-------|----------|------------------|\n| 1: Foundation | 2 weeks | Testing, DX, config |\n| 2: Database & Auth | 2 weeks | Persistence, user accounts |\n| 3: Monitoring & Validation | 2 weeks | Sentry, Zod, logging |\n| 4: Security | 2 weeks | Rate limiting, headers, virus scan |\n| 5: Docs & Monitoring | 2 weeks | OpenAPI, APM, health checks |\n| 6: Features | 2 weeks | Comparison, batch, templates |\n| 7: Accessibility & Performance | 2 weeks | WCAG compliance, optimization |\n| 8: CI/CD | 2 weeks | Automated pipeline, deployment |\n\n**Total: 16 weeks (4 months)**\n\n---\n\n## Next Steps\n\n1. Review and approve this plan\n2. Set up Phase 1 (Foundation & Testing)\n3. Begin implementation with highest priority items\n4. Regular progress reviews every 2 weeks\n5. Adjust timeline based on progress and feedback"]